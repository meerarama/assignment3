<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<div id ="title"> PEOPLE LIVING WITH HIV & AIDS</div>

<div id="subtext"> Type in a year from 1990-2015 below, or type the word "change" to see <br> which countries have the greatest change in the number of people <br> living with HIV/AIDS between 1990 and 2015. </div> <br>

<center>
  Year: <input type="text" id="usrname"> </input>
  <button onclick="getVal(); makeQueue()">Submit</button>
</center>

<div id = "globe">
		<center> <svg id="svg1" width="500" height="270"></svg> </center>
	</div>
<div>

<div id=blocks>

	<!-- AFRICA -->
	<div class="big">
		<div class="label"> AFRICA </div>
		<div class="country-box">
			<svg id="svg2" width="400" height="300"></svg> 
			<div class="info"><h1 id="afrname"></h1></div>
		</div> 
	</div>

	<!-- ASIA -->
	<div class="big">
		<div class="label"> ASIA </div>
		<div class="country-box">
			<svg id="svg3" width="400" height="300"></svg> 
			<div class="info"><h1 id="asianame"></h1></div>
		</div>
	</div>

	<!-- SOUTH AMERiCA AND MEXICO -->
	<div class="big">
		<div class="label"> SOUTH AMERICA </div>
		<div class="country-box">
			<svg id="svg4" width="400" height="300"></svg> 
			<div class="info"><h1 id="southname"></h1></div>
		</div>
	</div>

	<!-- EUROPE -->
	<div class="big">
		<div class="label"> EUROPE </div>
		<div class="country-box">
			<svg id="svg5" width="400" height="300"></svg> 
			<div class="info"><h1 id="europename"></h1></div>
		</div>
	</div>

</div>

<style>

	#title {
		text-align: center;
		margin-top: 40px;
		font-family: Arial;
		color: gray;
		font-size: 40px;
	}

	#subtext {
		text-align: center;
		font-family: Arial;
		margin-top: 20px;
		font-size: 15px;
		color:grey;
	}

	.big {
		display: inline-block;
	}

	.label {
		color: grey;
		font-family: Arial;
		font-size: 40px;
	}

	#intro {
		text-align: center;
		font-family: Arial;
		margin-top: 20px;
		font-size: 20px;
		color:grey;
	}

	.info {
		color:grey;
		font-family: Arial;
		font-size: 10px;
	}

	#blocks {
		text-align: center;
	}

	#globe {
		text-align: center;
		padding: 20px;
		margin-top: 20px;
	}

	#selection {
		text-align: center;
	}

	select {
	  background: transparent;
	  font-size: 14px;
	  height: 30px;
	  width: 200px;
	  padding: 5px; 
	  font-family: Arial;
	  margin: 20px;
	  border: solid 1px;
	  color: black;
	}

	.country-box {
		text-align: center;
		display: inline-grid;
		width: auto;
		height: auto;
		padding: 10px;
		margin: 5px 20px 20px 20px;
		border-style: solid;
		border-color: lightgrey;
	}

</style>

<script>

	function getVal() {
		year = document.getElementById('usrname').value
	}

	var svg1 = d3.select("#svg1"),
	  width = +svg1.attr("width"),
	  height = +svg1.attr("height");

	var svg2 = d3.select("#svg2"),
	  width = +svg2.attr("width"),
	  height = +svg2.attr("height");

	var svg3 = d3.select("#svg3"),
	  width = +svg3.attr("width"),
	  height = +svg3.attr("height");

	var svg4 = d3.select("#svg4"),
	  width = +svg4.attr("width"),
	  height = +svg4.attr("height");

	var svg5 = d3.select("#svg5");
	  width = +svg4.attr("width"),
	  height = +svg4.attr("height");

var path = d3.geoPath();
var projection = d3.geoMercator()
  .scale(100)
  .center([0,0])
  .translate([width / 2, height / 2]);

var projection1 = d3.geoMercator()
	.scale(220)
	.center([30, 0])
	.translate([width / 2, height / 2]);

var projection2 = d3.geoMercator()
	.scale(250)
	.center([85, 380])
	.translate([width / 2, height / 2]);

var projection3 = d3.geoMercator()
  .scale(190)
  .center([-65,-22])
  .translate([width / 2, height / 2]);

 var projection4 = d3.geoMercator()
  .scale(300)
  .center([25,405])
  .translate([width / 2, height / 2]);

var data = d3.map();
var colorScale = d3.scaleThreshold()
  .domain([400, 50000, 100000, 250000, 1000000, 3000000, 5000000])
  .range(d3.schemeReds[7]);

  	d3.queue()
	  .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
	  .defer(d3.csv, "https://raw.githubusercontent.com/meerarama/assignment3/master/finaldata.csv", 
	  	function getdata(d) 
	  		{ 
	  			//console.log(yr)
	  			data.set(d.code, +d.yr2015)
	  	  		//console.log(d.place);
	  		})
	  .await(ready); 

function makeQueue() {
	d3.queue()
	  .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
	  .defer(d3.csv, "https://raw.githubusercontent.com/meerarama/assignment3/master/finaldata.csv", 
	  	function getdata(d) 
	  		{ 
	  			var yr = 'yr'.concat(year)
	  			//console.log(yr)
	  			data.set(d.code, +d[yr])
	  	  		//console.log(d.place);
	  		})
	  .await(ready); }


function ready(error, topo) {

  let mouseOverAfrica = function(d) {
    d3.selectAll(".Country")
      .transition()
      .duration(200)
      .style("opacity", .1)
    d3.select(this)
      .transition()
      .duration(200)
      .style("opacity", 1.5)
      .text(function(d) {return d.properties.name})
      var name = d.properties.name
      //.text(d.properties.name)
      return document.getElementById('afrname').innerHTML=name;
      //.text(function(d) {return d.country;})
      //return tooltip.style("hidden", false).html(d.country);
      //.style("stroke", "black")
  }

    let mouseOverAsia = function(d) {
    d3.selectAll(".Country")
      .transition()
      .duration(200)
      .style("opacity", .2)
    d3.select(this)
      .transition()
      .duration(200)
      .style("opacity", 1.5)
      .text(function(d) {return d.properties.name})
      var name = d.properties.name
      //.text(d.properties.name)
      return document.getElementById('asianame').innerHTML=name;
      //.text(function(d) {return d.country;})
      //return tooltip.style("hidden", false).html(d.country);
      //.style("stroke", "black")
  }

    let mouseOverSouth = function(d) {
    d3.selectAll(".Country")
      .transition()
      .duration(200)
      .style("opacity", .2)
    d3.select(this)
      .transition()
      .duration(200)
      .style("opacity", 1.5)
      var name = d.properties.name
      return document.getElementById('southname').innerHTML=name;
  }

   let mouseOverEurope = function(d) {
    d3.selectAll(".Country")
      .transition()
      .duration(200)
      .style("opacity", .2)
    d3.select(this)
      .transition()
      .duration(200)
      .style("opacity", 1.5)
      .text(function(d) {return d.properties.name})
      var name = d.properties.name
      //.text(d.properties.name)
      return document.getElementById('europename').innerHTML=name;
      //.text(function(d) {return d.country;})
      //return tooltip.style("hidden", false).html(d.country);
      //.style("stroke", "black")
  }

  let mouseLeave = function(d) {
    d3.selectAll(".Country")
      .transition()
      .duration(200)
      .style("opacity", .8)
    d3.select(this)
      .transition()
      .duration(200)
      //.style("stroke", "transparent")
  }

  svg1.append("g")
    .selectAll("path")
    .data(topo.features)
    //console.log(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      })
      .transition()
      .duration(500)
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country" } )
      .style("opacity", .8)

   svg2.append("g")
    .selectAll("path")
    .data(topo.features)
    //console.log(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection1)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      })
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country" } )
      .text(function(d) { return d.properties.NAME; })
      .style("opacity", .8)
      .on("mouseover", mouseOverAfrica )
      .on("mouseleave", mouseLeave )

   svg3.append("g")
    .selectAll("path")
    .data(topo.features)
    //console.log(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection2)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      })
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country" } )
      .style("opacity", .8)
      .on("mouseover", mouseOverAsia )
      .on("mouseleave", mouseLeave )
    

    svg4.append("g")
    .selectAll("path")
    .data(topo.features)
    //console.log(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection3)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      })
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country" } )
      .style("opacity", .8)
      .on("mouseover", mouseOverSouth)
      .on("mouseleave", mouseLeave )

    svg5.append("g")
    .selectAll("path")
    .data(topo.features)
    //console.log(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection4)
      )
      // set the color of each country
      .attr("fill", function (d) {
        d.total = data.get(d.id) || 0;
        return colorScale(d.total);
      })
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country" } )
      .style("opacity", .8)
      .on("mouseover", mouseOverEurope )
      .on("mouseleave", mouseLeave )
    }

</script>
